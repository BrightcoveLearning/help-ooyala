<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en-us" lang="en-us">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta name="copyright" content="(C) Copyright 2005"/>
<meta name="DC.rights.owner" content="(C) Copyright 2005"/>
<meta name="DC.Type" content="concept"/>
<meta name="DC.Title" content="Sample: Installing and Running the Sample"/>
<meta name="abstract" content="You can use the following code sample to help you get started start creating your playback experience with Ooyala Cross-Device Resume and Google IMA ads integration and adding Player Token authentication."/>
<meta name="description" content="You can use the following code sample to help you get started start creating your playback experience with Ooyala Cross-Device Resume and Google IMA ads integration and adding Player Token authentication."/>
<meta name="DC.Format" content="XHTML"/>
<meta name="DC.Identifier" content="player_v3_dev_intro"/>
<meta name="DC.Language" content="en-us"/>
<link rel="stylesheet" type="text/css" href="../css/commonltr.css"/>
<link rel="stylesheet" type="text/css" href="../css/ooyala.css"/>
<title>Sample: Installing and Running the Sample</title>
</head>
<body id="player_v3_dev_intro">


 <h1 class="title topictitle1">Sample: Installing and Running the Sample</h1>

 
 <div class="body conbody"><p class="shortdesc">You can use the following code sample to help you get started start creating your
    playback experience with Ooyala Cross-Device Resume and Google IMA ads integration and adding
    Player Token authentication.</p>

 <div class="section"><p class="p">You can inspect this multi-feature code sample to help you get started working with the
          <a class="xref" href="book_api_player.html" title="The Player V3 API is a JavaScript API for customizing your Player v3 functionality and UI elements that also provides message bus event handling.">HTML5 Player APIs</a> and <a class="xref" href="player_v3_dev_eventmodel.html#player_v3_dev__eventmodel" title="The HTML5 Player V3 incorporates the use of a message bus to handle events.">EVENTS</a>.
        This code illustrates how to use Cross-Device Resume with Ooyala Secure Token Authentication
        and Google Interactive Media Ads (IMA).  This sample has two basic parts: </p>
<ul class="ul" id="player_v3_dev_intro__ul_svp_dpw_fm">
        <li class="li">Server-side logic implemented in PHP to handle requests.</li>

        <li class="li">Mulitple client-side web pages (views) that implement Player features including a basic
          player embed, Cross-Device Resume, Ooyala Token Authentication, Google IMA, Message
          Bus-based event handling and all of these features in combination. The views are additive:
          they progress from the simplest interaction to the final view, which contains all the code
          for using Cross-Device Resume, Ooyala Player Token, and Google IMA in combination. In this
          sample, the controller takes care of routing, handling requests, and sending parameters to
          each View. </li>

      </ul>
<p class="p"><strong class="ph b">How to Run the Sample</strong></p>
<p class="p">To run this code sample:</p>
<div class="p">
        <ol class="ol" id="player_v3_dev_intro__docs-internal-guid--76eb343-7d9d-0d2d-6698-8e3eb79b3cea">
          <li class="li">To see this full code sample running you need to have (or set up) a web server that
            can interpret PHP, like Apache or Nginx.</li>

          <li class="li">Have your Customer Success Manager enable Ooyala Player Token, Google IMA, and
            Cross-Device Resume features, if you do not already have them.</li>

          <li class="li">Get the code from our GitHub repository. The URL is: <a class="xref" href="https://github.com/ooyala/code-samples" target="_blank">https://github.com/ooyala/code-samples</a></li>

          <li class="li">Clone the GitHub code-samples repository onto your server.</li>

          <li class="li">Provide your local path in your browser URL:
            "your_base_path/code-samples/api-examples/CodeIgniter_app/index.php" For more
            information you can check: <a class="xref" href="http://ellislab.com/codeigniter/user-guide/installation/" target="_blank"> http://ellislab.com/codeigniter/user-guide/installation/</a></li>

          <li class="li">The path for this code sample in our public GitHub repository is: <a class="xref" href="https://github.com/ooyala/code-samples" target="_blank">code-samples</a> /<a class="xref" href="https://github.com/ooyala/code-samples/tree/master/api-examples" target="_blank"> api-examples</a> / CodeIgniter_app /</li>

          <li class="li">Use the Ooyala PHP Server SDK included with the sample in GitHub. If needed, you can
            also download the Ooyala PHP Server SDK (available on <span class="ph">Ooyala <a class="xref" href="../../../../../../../downloads.html" target="_blank">Downloads</a></span>).</li>

        </ol>

      </div>
<p class="p">The following sections describe some of the key features and files you will use in this
        code sample. </p>
<p class="p"><strong class="ph b">Server-Side Code</strong>
      </p>
For this code sample, we run the server in an CodeIgniter framework, which is provided as
      part of the code sample in our GitHub repository. The GitHub repository contains the PHP-based
      server-side code (CodeIgniter app) that you can use to run the samples. Designed to help you
      get up and running in very little time, the sample CodeIgniter app is already integrated with
      the Ooyala PHP SDK (<samp class="ph codeph">/application/third_party/php-v2-sdk</samp> ) so there is no need
      to add anything else. <p class="p">If you already have a server setup, you can adapt the code to your
        use. Or if you just want to run the code sample, you can clone the repository and copy it to
        your server. You don’t need to implement the PHP framework, as we provide it as part of the
        code sample. </p>
<p class="p"><strong class="ph b">What is CodeIgniter? </strong></p>
CodeIgniter is a framework in PHP
      designed to have as low overhead as possible. It follows an Model-View-Controller (MVC)
      pattern, where you pass information to the view in the following
        way:<samp class="ph codeph">$this-&gt;view-&gt;load("name_of_the_view", $data)</samp><p class="p">The relevant files
        are structured as
        follows:</p>
<pre class="pre codeblock">/application/assets/config/controllers/views/libraries/models/third_party   </pre>
<p class="p">The
          <samp class="ph codeph">third_party</samp> directory contains extra files such as the Ooyala
        SDK.</p>
<p class="p">CodeIgniter follows a URL path such as the
        following:</p>
<samp class="ph codeph">"base/controller/view/args"</samp><p class="p"><strong class="ph b">Client-Side Views</strong>
      </p>
<p class="p">The code sample includes multiple client web pages or views illustrating each feature
        and a seventh code sample that shows all the features working in combination. To implement
        each client page, you will need all the standard elements that you normally use such as your
        API Key and pcode (for details, see <a class="xref" href="api_keys.html" title="Your Ooyala API credentials include your API key and secret, which you provide to sign HTTP requests and when using the scratchpad.">Your API Credentials</a>), and so forth. </p>
<p class="p" id="player_v3_dev_intro__docs-internal-guid--76eb343-7da1-6fa1-5074-58f93b6be835">To explore these code sample
        views, in GitHub, go to:</p>
<samp class="ph codeph"><a class="xref" href="https://github.com/ooyala/code-samples" target="_blank">code-samples</a>/<a class="xref" href="https://github.com/ooyala/code-samples/tree/master/api-examples" target="_blank">api-examples</a>/<a class="xref" href="https://github.com/ooyala/code-samples/tree/master/api-examples/CodeIgniter_app" target="_blank">CodeIgniter_app</a>/<a class="xref" href="https://github.com/ooyala/code-samples/tree/master/api-examples/CodeIgniter_app/application" target="_blank">application</a>/views/</samp>
      <p class="p" id="player_v3_dev_intro__docs-internal-guid--76eb343-7da1-f56a-d866-ed93b4ac8b4b">The code samples
        include:</p>
<ol class="ol" id="player_v3_dev_intro__ol_zv4_nqw_fm">
        <li class="li"><strong class="ph b">simple.php</strong> - This file contains the simplest building block for using the Player.
          It contains the embed code for a running a single player on a web page </li>

        <li class="li"><strong class="ph b">token.php</strong> - Token Authentication for a single player on a web page.</li>

        <li class="li"><strong class="ph b">google_ima.php</strong>  - This file contains the code to implement the Google IMA ad
          manager.</li>

        <li class="li"><strong class="ph b">cross_resume.php</strong> - This file contains the code with player_tokenauth - This file
          contains the code to implement the Ooyala Player </li>

        <li class="li"><strong class="ph b">message-bus.php</strong> and message-bus-advanced.php - these files illustrate the use of
          our message bus for event handling.</li>

        <li class="li"><strong class="ph b">multi-feature-sample.php</strong> - This file contains the code that combines all of the
          features.</li>

      </ol>
<p class="p">The following sections describe the implementation of each of these client-side
        views.</p>
<p class="p">
        <strong class="ph b">Ooyala Player Token Client Code</strong>
      </p>
<p class="p">The <samp class="ph codeph">token.php</samp> file implements Ooyala Player Token authentication
        content protection.  </p>
<p class="p"><strong class="ph b">How the Player Token Sample Works</strong></p>
In this Player Token
      sample, we use the following Player V3 APIs and parameters.<ul class="ul" id="player_v3_dev_intro__ul_ghp_gly_3m">
        <li class="li"><span class="keyword apiname">OO.ready()</span> - This function indicates that the script has loaded,
          initialized completely, and that the player is ready for playback. </li>

        <li class="li"><span class="keyword apiname">OO.Player.create()</span> - This function creates a new message bus, creates
          any registered modules, and connects registered modules to the message bus. In the sample,
          you should note that <samp class="ph codeph">OO.Player.create</samp> is sued with embedToken in the hash
          with the embed token url as part of the key value pair.</li>

        <li class="li"><span class="keyword apiname">platform</span> - This parameter is used to control selection of HTML5 or
          Flash playback. In the sample, it is set to Flash as the priority choice for
          playback.</li>

      </ul>
<div class="p">
        <div class="note note"><span class="notetitle">Note:</span> Before using the token in your code, review all of the <a class="xref" href="player_v3dev_authoverview.html#player_v3_dev_bitbuff">Ooyala Player
            Token documentation.</a>
        </div>

      </div>
<div class="p">To implement the sample, we do the following:<ol class="ol" id="player_v3_dev_intro__ol_xsx_hs2_jm">
          <li class="li">Manually set the <strong class="ph b">Require Ooyala Player Token</strong> checkbox in Backlot. See<a class="xref" href="../tasks/player_v3dev_settoken.html#player_v3dev_settoken" title="The Backlot UI provides you with an option to secure your content by setting a Syndication group flag adding your content assets to this syndication group. This will enable you to set up your web page to run your player(s), and send the authorization token. (Available only if your Ooyala account includes the Ooyala Player Token. To enable this functionality, contact your account manager.)">
              “Setting the Ooyala Player Token.”</a></li>

          <li class="li">Craft an authorization request using the URL token request template. See <a class="xref" href="player_v3dev_authoverview.html#player_v3_dev_bitbuff">Ooyala Player Token for Player V3 (Deprecated)</a>.</li>

          <li class="li">Create the trigger to request authorization and a token from the Ooyala authorization
            server, using the token request. See <a class="xref" href="player_v3dev_authoverview.html#player_v3_dev_bitbuff__section_eww_vc5_js">Complete Web Example: Authorize Playback and Obtain a Token</a>. </li>

          <li class="li">Generate a computed signature. You need to generate signature using an http method.
            You can use the PHP SDK or Ruby SDK to do this. The included PHP SDK has a mechanism to
            generate the signature needed by the Ooyala Player Token. (See <a class="xref" href="player_v3dev_authoverview.html#player_v3_dev_bitbuff">Ooyala Player Token for Player V3 (Deprecated)</a>). When you generate the
            signature, you will have two parameters: <ul class="ul" id="player_v3_dev_intro__ul_cbg_vsy_3m">
              <li class="li">a query parameter and</li>

              <li class="li">an HTTP method. For the Ooyala Player Token, you need to use a GET request for the
                http method.</li>

            </ul>
</li>

          <li class="li">Assemble the request and concatenate the results. </li>

        </ol>
</div>
<p class="p"><strong class="ph b">Google IMA Client Code</strong>
      </p>
<p class="p">The <strong class="ph b">google_ima.php</strong> sample view introduces the use of the
          <strong class="ph b">google-ima-ads-manager</strong> on the client-side to handle the insertion of various types
        of ads into a player. This implementation shows the use of a companion ad with a player.
          </p>
<p class="p"><strong class="ph b">How the Google IMA Sample Works</strong></p>
In this Google IMA sample, we use the
      following Player V3 APIs and parameters.<ul class="ul" id="player_v3_dev_intro__ul_dqh_jxf_jm">
        <li class="li"><span class="keyword apiname">OO.Player.create()</span> - In the sample, you should note that
            <samp class="ph codeph">OO.Player.create</samp> is used with the google ad tag.</li>

        <li class="li"><span class="keyword apiname">google-ima-ads-manager</span> - The google-ima-ads manager parameter is set
          in the hash of the <samp class="ph codeph">OO.Player.create</samp> function. It takes an adTagUrl as
          part of a key value pair. In this sample, we pass the response from the PHP server
          containing the ad server URL.</li>

        <li class="li"><span class="keyword apiname">mb.subscribe</span> - This function is used to subscribe to events and pass
          them to the console log.</li>

      </ul>
<p class="p"> Before you start working with the Ooyala Google IMA sample: </p>
<div class="p">
        <ol class="ol" id="player_v3_dev_intro__docs-internal-guid--76eb343-7da4-b4df-4c18-02827caf61be">
          <li class="li">You need to know what Google IMA does and how it works. For more information, see
              <a class="xref" href="../reference/player_v3_dev_adsparams.html#player_v3_dev_adsparams" title="Customize ads using embedded parameters.">“Ads Embedded Parameters.”</a></li>

          <li class="li">If you have an asset and want Google IMA, you must remember that Google IMA must be
            set on a per player basis.</li>

          <li class="li">Associate your Google IMA ads with your video assets in Ooyala Backlot.  For more
            information, see <a class="xref" href="../tasks/monetization_ads_adsets_adnetworks_wrapper.html#task_wlz_nm4_zh" title="This material includes how to create ad sets in Backlot and how to integrate with ad sources.">“Working with Your Own Ad Assets, Ad Sets, and Ad Sources.”</a></li>

          <li class="li">Set up the Google IMA ad tags. You can also do this within Backlot. For more
            information, see <a class="xref" href="../tasks/monetization_ads_adsets_adnetworks_wrapper.html#task_wlz_nm4_zh" title="This material includes how to create ad sets in Backlot and how to integrate with ad sources.">“Working with Your Own Ad Assets, Ad Sets, and Ad Sources,”</a>
              “<a class="xref" href="../tasks/monetization_ads_adsets_integratingadnetworks.html#task_wcr_ll2_yh" title="Instead of using your own assets, you can work with other ad sources.">Creating Ad Sets for Integration with Ad Sources,”</a> and “<a class="xref" href="../reference/adset_fields_google.html" title="The fields described here are for Backlot ad sets with ad source set to Google IMA V3.">Ad Set Fields for
              Google.</a>”</li>

        </ol>

      </div>
<p class="p">
        <strong class="ph b">Cross Device Resume (XDR) Client Code</strong>
      </p>
<p class="p"> The <samp class="ph codeph">cross_resume.php</samp> file code implements a client-side version of
        Ooyala Cross Device Resume (XDR) as a sample. We have implemented a simple version of XDR so
        you can see how it works. Cross-Device Resume, of course, is designed to work with our
        mobile SDKs and from the desktop or mobile device to an appropriate TV type. For more
        information about XDR, see “ <a class="xref" href="player_v3_dev_xdintro.html" title="The Ooyala Player includes support for Cross-Device Resume (XDR) that enables you to provide a seamless video experience across multiple devices."> "Player for Cross Device Resume."</a></p>
<div class="note note"><span class="notetitle">Note:</span> Before you work with any
        feature, including Ooyala Cross Device Resume (XDR), you need to make sure the feature is
        enabled. Contact your Customer Success Manager to set this up. If you do not have XDR
        enabled, you can make a request but the server will give you an empty response. You may not
        be able to quickly debug the empty response as there is no specific message indicating that
        you have not enabled the feature.  Make sure you have the feature enabled before you start.
          </div>
<p class="p"><strong class="ph b">How the XDR Sample Works</strong></p>
<p class="p">In implementing XDR for this sample, we
        limited the code to perform XDR from desktop to desktop for simplicity.  XDR supports start
        and resume across mobile devices, desktops,  and XTV enabled TVs. For more information about
        XDR, see “ <a class="xref" href="player_v3_dev_xdintro.html" title="The Ooyala Player includes support for Cross-Device Resume (XDR) that enables you to provide a seamless video experience across multiple devices.">Player for Cross
          Device Resume.</a>”</p>
<p class="p">In this XDR client sample, we pass the playhead time from the
        PHP server to var playheadTime. We create the player with <span class="keyword apiname">OO.Player.create
          ()</span> function and set the <samp class="ph codeph"><strong class="ph b">embedToken</strong></samp> parameter and pass
        the <samp class="ph codeph"><strong class="ph b">playheadTime</strong></samp> to the <samp class="ph codeph"><strong class="ph b">initialTime</strong></samp>
        parameter.</p>
<p class="p"><strong class="ph b"> Message Bus Event Handling</strong>
      </p>
<p class="p">One important feature of Player V3 is its message bus event handling mechanism. This
        code sample includes the use of the V3 message bus to implement some event handling
        functions. </p>
<ul class="ul" id="player_v3_dev_intro__docs-internal-guid--76eb343-7da6-6dd6-7fb0-d149abb7926a">
        <li class="li">
          <p class="p"><strong class="ph b">message_bus.php</strong> - Used for the set up of event handling.</p>

        </li>

        <li class="li">
          <p class="p"><strong class="ph b">message_bus_advanced.php</strong> - Illustrates the set up of event handling and the
            display of event milestones in an area beneath the player.</p>

        </li>

      </ul>
<p class="p">These files implement event handling code to demonstrate the following:</p>
<ul class="ul">
        <li class="li">
          <p class="p">Video start and play</p>

        </li>

        <li class="li">
          <p class="p">Video pause</p>

        </li>

        <li class="li">
          <p class="p">Video reached 25% milestone</p>

        </li>

        <li class="li">
          <p class="p">Video reached 50% milestone</p>

        </li>

        <li class="li">
          <p class="p">Video reached 75% milestone</p>

        </li>

        <li class="li">
          <p class="p">Video complete</p>

        </li>

        <li class="li">
          <p class="p">Ad break started</p>

        </li>

        <li class="li">
          <p class="p">Ad request made</p>

        </li>

        <li class="li">Ad request successful </li>

        <li class="li">
          <p class="p">Ad played through 100%</p>

        </li>

        <li class="li">
          <p class="p">Ad break finished</p>

        </li>

      </ul>
<p class="p"> Here is a portion of the code for handling these types of events from the <a class="xref" href="https://github.com/ooyala/code-samples/tree/master/api-examples/CodeIgniter_app/application/assets/javascript" target="_blank">
          code-samples/api-examples/CodeIgniter_app/application/assets/javascript/simple_milestones.js</a>
        file. In this code snippet, we subscribe to the PLAYING event. This javascript file uses the
          <samp class="ph codeph">CONTENT_TREE_FETCHED</samp>, <samp class="ph codeph">PLAYING</samp>,
          <samp class="ph codeph">PLAYHEAD_TIME_CHANGED</samp>, and <samp class="ph codeph">PLAYED</samp> events. For a full
        list of the message bus OO.EVENTS that you can use in your code, see <a class="xref" href="../api/player_v3_api_events.html#player_v3_api_events" title="Use message bus events to subscribe to or publish player events from video to ad playback.">Player Message
          Bus Events</a>.</p>
<pre class="pre codeblock">this.mb = window.mb; 
    .
    .
    .
this.mb.subscribe(OO.EVENTS.PLAYING, "func2", function (eventName, arg1, arg2) {
        if (videoEnded) {
            // Reset all values
            // We are asuming we hit replay on the same video
            videoStarted = false;
            _25per = false;
            _50per = false;
            _75per = false;
            videoEnded = false;
            write("Replaying video");
        }
            .
            .
            . </pre>
<p class="p">In the <samp class="ph codeph">message_bus_advanced.php</samp> file we provide a
        div id called <samp class="ph codeph">logName</samp> to create a text area where we display the milestone
        events collected from the <samp class="ph codeph">simple_milestones.js</samp>. In this script we subscribe
        to <samp class="ph codeph">OO.EVENTS.PLAYING</samp> and use
          <samp class="ph codeph">OO.EVENTS.PLAYHEAD_TIME_CHANGED</samp> to account for scrubbing. When you run
        the sample, you should see the output of the event handling tasks from the .js logic written
        to the screen, like so: </p>

      <img class="image" src="../image/xmp_display_events.png" height="317" width="448"/>
      <p class="p"><strong class="ph b"> Multi-Feature Sample </strong>   </p>
<p class="p">Our public GitHub repository also contains the
          <samp class="ph codeph">multi-feature_sample.php</samp> file. This file contains the server side code
        and a client web page that combines all the client-side code for implementing all of the
        features described in the prior sections so you can see a single working sample that
        demonstrates ads integration with Google IMA, Ooyala Cross-Device Resume, and authentication
        with the Ooyala Player Token. It also includes the PHP Server-Side code to handle requests.
      </p>
</div>

</div>


</body>
</html>