<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en-us" lang="en-us">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta name="copyright" content="(C) Copyright 2005"/>
<meta name="DC.rights.owner" content="(C) Copyright 2005"/>
<meta name="DC.Type" content="concept"/>
<meta name="DC.Title" content="Programming Bitrates and Buffering for Flash Player V3 Using JavaScript (Deprecated)"/>
<meta name="abstract" content="Ooyala provides bitrate and buffering functions and events. In addition, Ooyala uses a number of heuristics to make playback as smooth as possible."/>
<meta name="description" content="Ooyala provides bitrate and buffering functions and events. In addition, Ooyala uses a number of heuristics to make playback as smooth as possible."/>
<meta name="DC.Relation" scheme="URI" content="../api/player_v3_apis.html"/>
<meta name="DC.Relation" scheme="URI" content="../api/player_v3_api_events.html"/>
<meta name="DC.Format" content="XHTML"/>
<meta name="DC.Identifier" content="player_v3_dev_bitbuff"/>
<meta name="DC.Language" content="en-us"/>
<link rel="stylesheet" type="text/css" href="../css/commonltr.css"/>
<link rel="stylesheet" type="text/css" href="../css/ooyala.css"/>
<title>Programming Bitrates and Buffering for Flash Player V3 Using JavaScript (Deprecated)</title>
</head>
<body id="player_v3_dev_bitbuff">


 <h1 class="title topictitle1">Programming Bitrates and Buffering for Flash Player V3 Using JavaScript (Deprecated)</h1>

 
 <div class="body conbody"><p class="shortdesc">Ooyala provides bitrate and buffering functions and events. In addition, Ooyala uses a
  number of heuristics to make playback as smooth as possible.</p>

  <div class="section"><div class="note important"><span class="importanttitle">Important:</span> Ooyala Player V3 is deprecated and is scheduled
    to be <em class="ph i">disabled</em> on 2018-01-31. After that date, Player V3 will no longer play your video
    or audio content. Customers still using Player V3 need to migrate to Player V4 (see <a class="xref" href="pbv4_migration_v3.html">Migrating from Player V3</a> and <a class="xref" href="pbv4_migration_faq.html">Player Migration FAQ</a>).</div>
Bitrates and buffer control for Flash (RTMP, HDS, Akamai HD2) are supported in the Flash
   Player V3. See the example code in <a class="xref" href="player_v3_dev_javascript_body_content_withmethods.html#player_v3_javascript_complete" title="Use event listeners and Player V3 API methods to retrieve the asset's information you want to work with.">Information with Listeners and Method Calls</a>.<p class="p">End users can use a bitrate selector in the Flash player UI to select from bitrate
    options. To enable the bitrate selector for a Flash player, <a class="xref" href="../tasks/player_basic_settings.html" title="Use the Backlot UI to configure the player look and feel. Any changes are automatically applied to all videos, channels, and channel sets that use the player.">enable user controls</a> for the
    player in Backlot.</p>
<p class="p">Bitrate controls on the player UI and bitrate APIs are supported on
    Flash for all content types (Ooyala VOD, remote VOD, remote live, remote live DV).
   </p>
</div>

  <div class="section">
   <p class="p">The following table shows the JavaScript methods for bitrates and buffering. For detailed API docs, please see <a class="xref" href="https://docs.brightcove.com/apidocs-ooyala/player_js/OO.Player.html#getBitrateInfo" target="_blank">https://docs.brightcove.com/apidocs-ooyala/player_js/OO.Player.html#getBitrateInfo</a>.</p>

   <div class="note note"><span class="notetitle">Note:</span> The following APIs do not apply to the HTML5 player or mobile SDKs.</div>

   
<div class="tablenoborder"><table cellpadding="4" cellspacing="0" summary="" id="player_v3_dev_bitbuff__table_n3k_rjr_lh" class="table" frame="border" border="1" rules="all"><caption><span class="tablecap">Table 1. JavaScript Methods for Bitrates and Buffering</span></caption>
     
     
     <thead class="thead" align="left">
      <tr class="row">
       <th class="entry" valign="top" width="50%" id="d609046e75"> get Methods </th>

       <th class="entry" valign="top" width="50%" id="d609046e78"> set Methods </th>

 
      </tr>

     </thead>

     <tbody class="tbody">
      <tr class="row">
       <td class="entry" valign="top" width="50%" headers="d609046e75 ">
        <ul class="ul" id="player_v3_dev_bitbuff__internal-source-marker_0.7785623416183959">
         <li class="li">
          <span class="keyword apiname">getBitratesAvailable()</span></li>

         <li class="li">
          <span class="keyword apiname">getBitrateQualitiesAvailable()</span></li>

         <li class="li">
          <span class="keyword apiname">getTargetBitrate()</span></li>

         <li class="li">
          <span class="keyword apiname">getTargetBitrateQuality()</span></li>

         <li class="li">
          <span class="keyword apiname">getBufferLength()</span>
         </li>

         <li class="li">
          <span class="keyword apiname">getBitrateInfo()</span></li>

        </ul>

       </td>

       <td class="entry" valign="top" width="50%" headers="d609046e78 ">
        <ul class="ul" id="player_v3_dev_bitbuff__internal-source-marker_0.7785623416183958">
         <li class="li">
          <span class="keyword apiname">setTargetBitrate</span><samp class="ph codeph">(<em class="ph i">bitrate</em>)</samp></li>

         <li class="li">
          <span class="keyword apiname">setTargetBitrateQuality()</span></li>

        </ul>

       </td>

       
      </tr>

     </tbody>

    </table>
</div>

  </div>

  <div class="section"><h2 class="title sectiontitle">JavaScript Console Log for <samp class="ph codeph">setTargetBitrate</samp></h2>
   
   <p class="p">Calls to the bitrate control API <samp class="ph codeph">setTargetBitrate</samp> supply additional information to the
    browser's built-in JavaScript console log. You can use this log for end user video
    configuration. </p>

   <p class="p">See the table below for the possible input values for
     <samp class="ph codeph">your_player_ID.setTargetBitrate(X)</samp> and their corresponding JavaScript console
    log outputs. When the entered value in invalid, the actual targetBitrate value is adjusted to
    match the reported possible value.</p>

   
<div class="tablenoborder"><table cellpadding="4" cellspacing="0" summary="" class="table" frame="border" border="1" rules="all">
     <thead class="thead" align="left">
      <tr class="row">
       <th class="entry" valign="top" id="d609046e178"><samp class="ph codeph">your_player_ID.setTargetBitrate(X)</samp></th>

       <th class="entry" valign="top" id="d609046e182">JavaScript Console Log Output</th>

       

      </tr>

     </thead>

     <tbody class="tbody">
      <tr class="row">
       <td class="entry" valign="top" headers="d609046e178 d609046e182 ">X is equal to one of the available stream bitrates</td>

       <td class="entry" valign="top" headers="d609046e178 d609046e182 "><samp class="ph codeph">"targetBitrate set to: X"</samp></td>


      </tr>

      <tr class="row">
       <td class="entry" valign="top" headers="d609046e178 d609046e182 ">X is not equal to any available stream bitrate but is higher than one of the available
        stream bitrates, Y (Y is chosen as the closest bitrate below X)</td>

       <td class="entry" valign="top" headers="d609046e178 d609046e182 "><samp class="ph codeph">"Desired targetBitrate of X is invalid. Setting targetBitrate to nearby value of Y"</samp></td>

   
      </tr>

      <tr class="row">
       <td class="entry" valign="top" headers="d609046e178 d609046e182 "> 0 &lt; X &lt; the lowest available stream, Y (X is between 0 and the lowest stream, Y) </td>

       <td class="entry" valign="top" headers="d609046e178 d609046e182 "><samp class="ph codeph">"Desired targetBitrate of X is invalid. Setting targetBitrate to nearby value of Y"</samp></td>

  
      </tr>

      <tr class="row">
       <td class="entry" valign="top" headers="d609046e178 d609046e182 "> X &lt;= 0</td>

       <td class="entry" valign="top" headers="d609046e178 d609046e182 "><samp class="ph codeph">"Negative or zero-value targetBitrate attempted, using targetBitrate of -1 to set bitrate to auto."</samp></td>

      
      </tr>

      <tr class="row">
       <td class="entry" valign="top" headers="d609046e178 d609046e182 ">X is an invalid value, such as a non-numerical value</td>

       <td class="entry" valign="top" headers="d609046e178 d609046e182 "><samp class="ph codeph">"Invalid targetBitrate attempted, using targetBitrate of -1 to set bitrate to auto."</samp></td>

     
      </tr>

      <tr class="row">
       <td class="entry" valign="top" headers="d609046e178 d609046e182 ">Manual bitrate setting cannot be done</td>

       <td class="entry" valign="top" headers="d609046e178 d609046e182 "><samp class="ph codeph">"Manual targetBitrate setting has not been enabled, using targetBitrate of -1 to set bitrate to auto."</samp></td>

      </tr>

  
     </tbody>

    </table>
</div>

</div>

  <div class="section"><h2 class="title sectiontitle">Example</h2>
   
   <p class="p">The example below will show determining what bitrates are available and then will show what
    happens when you attempt to set some incorrect and correct values. This example assumes the
    player ID is 'pp'. You will often see 'undefined' in the console logs, which is normal for the
    bitrate API. These examples crop out items in the console log that are not relevant to the
    example.</p>

   <p class="p"><strong class="ph b">Determining Available Bitrates</strong></p>

   <pre class="pre codeblock">pp.getBitratesAvailable()
Array [ 198, 364, 728, 1328, 2328, 4528 ]</pre>

   <p class="p"><strong class="ph b">Setting the Bitrate Where 0&lt;Bitrate&lt;Minimum Available Bitrate
    </strong></p>

   <p class="p">Setting a value above 0 but lower than the minimum available bitrate is a special case that rounds up to the lowest available bitrate, and changes the 'targetBitrate' to that value.</p>

   <pre class="pre codeblock">pp.setTargetBitrate(20)
undefined
Desired targetBitrate of 20 is invalid. Setting targetBitrate to nearby value of 198

pp.getTargetBitrate()
198

pp.getTargetBitrateQuality()
"low" </pre>

   <p class="p"><strong class="ph b">Setting a Non-Number Bitrate</strong></p>

   <p class="p">Any non-number is always treated as an attempt to flip ABR back on. The API uses '-1' as a placeholder for ABR being on, so the 'targetBitrate' is adjusted to '-1'.</p>

   <pre class="pre codeblock">pp.setTargetBitrate("hello there")
Invalid targetBitrate attempted, using targetBitrate of -1 to set bitrate to auto.

pp.getTargetBitrate()
-1

pp.getTargetBitrateQuality()
"auto"
   </pre>

   <p class="p"><strong class="ph b">Setting the Bitrate to 0</strong></p>

   <p class="p">Attempts to set bitrates to zero also flip ABR back on, and move the targetBitrate to the placeholder value of '-1'.</p>

   <pre class="pre codeblock">pp.setTargetBitrate(0)
Negative or zero-value targetBitrate attempted, using targetBitrate of -1 to set bitrate to auto.

pp.getTargetBitrate()
-1

pp.getTargetBitrateQuality()
"auto"</pre>

   <p class="p"><strong class="ph b">Setting the Bitrate to a Value &lt;0</strong></p>

   <p class="p">Any negative value is always treated as an attempt to flip ABR back on. Again the 'targetBitrate' value is then moved to the '-1' placeholder value.</p>

   <pre class="pre codeblock">pp.setTargetBitrate(-501)
Negative or zero-value targetBitrate attempted, using targetBitrate of -1 to set bitrate to auto.

pp.getTargetBitrate()
-1

pp.getTargetBitrateQuality()
"auto"</pre>

   <p class="p"><strong class="ph b">Setting the Bitrate to -1</strong></p>

   <p class="p">Actually using '-1' of course flips on ABR, and keeps the targetBitrate at '-1' as the ABR placeholder. Using '-1' is the proper way to use the manual API to flip the auto 'ABR' system back on.</p>

  <pre class="pre codeblock">pp.setTargetBitrate(-1)
Negative or zero-value targetBitrate attempted, using targetBitrate of -1 to set bitrate to auto.

pp.getTargetBitrate()
-1</pre>

   <p class="p"><strong class="ph b">Setting the Bitrate to a Value One Below a Valid Value</strong></p>

   <p class="p">Even though this is only 1 below the next value up, the API always rounds down. So here it rounds down to 364.</p>

   <pre class="pre codeblock">pp.setTargetBitrate(727)
Desired targetBitrate of 727 is invalid. Setting targetBitrate to nearby value of 364

pp.getTargetBitrate()
364

pp.getTargetBitrateQuality()
"low"</pre>

   <p class="p"><strong class="ph b">Setting the Bitrate to an Existing Value</strong></p>

   <p class="p">Setting an existing value simply tells you the value is set.</p>

   <pre class="pre codeblock">pp.setTargetBitrate(728)
targetBitrate set to: 728

pp.getTargetBitrate()
728

pp.getTargetBitrateQuality()
"medium"</pre>

   <p class="p"><strong class="ph b">Setting the Bitrate to a Value One Above a Valid Value</strong></p>

   <p class="p">Again the API always rounds down, so this attempt of 729 is treated as 728.</p>

   <pre class="pre codeblock">pp.setTargetBitrate(729)
Desired targetBitrate of 729 is invalid. Setting targetBitrate to nearby value of 728

pp.getTargetBitrate()
728</pre>

   <p class="p"><strong class="ph b">Setting the Bitrate to an Existing Value</strong></p>

   <p class="p">Setting an existing value simply tells you the value is set.</p>

   <pre class="pre codeblock">pp.setTargetBitrate(4528)
targetBitrate set to: 4528

pp.getTargetBitrate()
4528

pp.getTargetBitrateQuality()
"high"</pre>

   <p class="p"><strong class="ph b">Setting the Bitrate to a Value Above the Maximum Bitrate</strong></p>

   <p class="p">Setting any value above the maximum available bitrate rounds down to the maximum, changing the 'targetBitrate' to that maximum value.</p>

   <pre class="pre codeblock">pp.setTargetBitrate(9000000000528)
Desired targetBitrate of 9000000000528 is invalid. Setting targetBitrate to nearby value of 4528

pp.getTargetBitrate()
4528

pp.getTargetBitrateQuality()
"high"</pre>

   <p class="p"><strong class="ph b">Setting the Bitrate Quality</strong></p>

   <p class="p">Setting quality picks a targetBitrate. Low will pick the lowest, high the highest, and medium rounds up to a valid value near the middle on an even number of streams, or the middle on an odd number of streams. Available qualities are always low, medium, high, and auto unless the stream has less than 3 available bitrates.</p>

  <pre class="pre codeblock">pp.getBitrateQualitiesAvailable()
Array [ "high", "medium", "low", "auto" ]

pp.setTargetBitrateQuality("low")
pp.getTargetBitrate()
198

pp.setTargetBitrateQuality("medium")
pp.getTargetBitrate()
1328

pp.setTargetBitrateQuality("high")
pp.getTargetBitrate()
4528

pp.setTargetBitrateQuality("auto")
pp.getTargetBitrate()
-1</pre>

   <p class="p"><strong class="ph b">Setting a Misspelled Target Bitrate Quality</strong></p>

   <p class="p">Setting targetBitrateQuality will not report an error back to the console if it is misspelled. getBitrateInfo is a generalized summary of your current status with the bitrate API:</p>

   <pre class="pre codeblock">pp.setTargetBitrateQuality("auto")

pp.getBitrateInfo()
Object { bitrateQualities: Array[4], bitrates: Array[6], targetBitrateQuality: "auto", targetBitrate: -1 }

pp.setTargetBitrate(728)
pp.getBitrateInfo()
Object { bitrateQualities: Array[4], bitrates: Array[6], targetBitrateQuality: "medium", targetBitrate: 728 }</pre>

   <p class="p">As the example contained 6 valid bitrates, this returns an array of 6 bitrates, and 4
    qualities.</p>

  </div>

  <div class="section"><h2 class="title sectiontitle">About ABR</h2><p class="p"> In addition to the bitrate and buffer functions and events,
    Ooyala uses a number of heuristics to make playback as smooth as possible on every device, such
    as bandwidth estimation, content size, screen size and so forth. ABR playback (HLS,
    specifically) is preferred whenever available on the underlying devices. </p>
ABR stands for
   Adaptive Bite Rate. This is a technology that allows the Ooyala Player to adjust/change the
   bitrate of the stream delivered based on the bandwidth available to the viewer as measured over a
   period of time. The purpose of ABR is to compensate for drops or increases in bandwidth by
   lowering or upgrading the stream quality. The ABR changes to the stream quality do not happen
   immediately. This is not an instantaneous process. To make a bitrate change to the video stream,
   the player: <ul class="ul">
    <li class="li">Detects the change in bandwidth.</li>

    <li class="li">Waits to confirm it is permanent vs. a momentary fluctuation.</li>

    <li class="li">Sends a request to the Akamai Flash Media Server to shift to stream at the new bitrate.</li>

    <li class="li">Waits for Akamai to deliver the new bitrate stream.</li>

    <li class="li">Starts delivering the new bitrate to the viewer.</li>

   </ul>
ABR takes effect only when the player has detected there is sufficient bandwidth available
   to support a higher bitrate and higher quality stream. To upgrade the player makes multiple
   checks over a period of time. If all of the checks show the viewer has the required bandwidth to
   support a higher stream, then it will upgrade. If any of the checks fail to show the required
   bandwidth, then the process is repeated. The upgrade also depends on the buffer length meeting a
   minimal threshold, and being stable or increasing. Dropping the bitrate of the stream being
   delivered is done to favor smooth and uninterrupted playback. Therefore, if the player sees the
   buffer size dropping, then it will start the process of downgrading the bitrate in order to have
   a lower bitrate stream available when the current buffer is exhausted. <div class="note note"><span class="notetitle">Note:</span> The current Ooyala
    player does not support <samp class="ph codeph">activePanelChanged</samp>, <samp class="ph codeph">ratingsApiReady</samp>,
    and <samp class="ph codeph">relatedMediaReady</samp> events. Although the <samp class="ph codeph">apiReady</samp>,
     <samp class="ph codeph">playerCreated</samp>, <samp class="ph codeph">loadComplete</samp>, and
     <samp class="ph codeph">playerEmbedded</samp> events are not provided in the player, you can use the
     <samp class="ph codeph">PLAYBACK_READY</samp> Event for equivalent functionality.</div>

  </div>

 </div>

 <div class="related-links"><div class="relinfo relref"><strong>Related reference</strong><br/>
<div><a class="link" href="../api/player_v3_apis.html" title="Player V3 JavaScript functions can be used to customize the player behavior and appearance.">Player V3 JavaScript API Functions</a></div>
<div><a class="link" href="../api/player_v3_api_events.html" title="Use message bus events to subscribe to or publish player events from video to ad playback.">Player V3 Message Bus Events (Deprecated)</a></div>
</div>
</div>

</body>
</html>