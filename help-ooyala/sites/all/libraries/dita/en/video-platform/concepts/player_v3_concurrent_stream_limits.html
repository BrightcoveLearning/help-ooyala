<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en-us" lang="en-us">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta name="copyright" content="(C) Copyright 2005"/>
<meta name="DC.rights.owner" content="(C) Copyright 2005"/>
<meta name="DC.Type" content="concept"/>
<meta name="DC.Title" content="Limiting Concurrent Streams per Viewer"/>
<meta name="abstract" content="By default, your Ooyala Backlot provider account limits each viewer account to 2 concurrent streams. This feature discourages viewers from sharing their credentials with friends who don’t have accounts. If the viewer, or someone with their account credentials, tries to open an additional stream while the maximum number of streams is open, the player displays a message and refuses to open the stream. This default limit applies across all of the syndication groups (aka publishing rules) within your provider account. You change this limit, and you can enable or disable the limit on a per-group basis. You can also enable or disable this setting for the default group. You can change your Ooyala Backlot provider account limit. You can also set this type of limit at the asset level. For example, your provider account limit could be 3, and your asset-level limit could be 1. In this case, three friends or family members could log in using the same credentials and watch three different assets concurrently, but would be blocked from watching any particular asset concurrently."/>
<meta name="description" content="By default, your Ooyala Backlot provider account limits each viewer account to 2 concurrent streams. This feature discourages viewers from sharing their credentials with friends who don’t have accounts. If the viewer, or someone with their account credentials, tries to open an additional stream while the maximum number of streams is open, the player displays a message and refuses to open the stream. This default limit applies across all of the syndication groups (aka publishing rules) within your provider account. You change this limit, and you can enable or disable the limit on a per-group basis. You can also enable or disable this setting for the default group. You can change your Ooyala Backlot provider account limit. You can also set this type of limit at the asset level. For example, your provider account limit could be 3, and your asset-level limit could be 1. In this case, three friends or family members could log in using the same credentials and watch three different assets concurrently, but would be blocked from watching any particular asset concurrently."/>
<meta name="DC.Relation" scheme="URI" content="../concepts/authorization_overview.html"/>
<meta name="DC.Format" content="XHTML"/>
<meta name="DC.Identifier" content="concept_ynm_ms5_3j"/>
<meta name="DC.Language" content="en-us"/>
<link rel="stylesheet" type="text/css" href="../css/commonltr.css"/>
<link rel="stylesheet" type="text/css" href="../css/ooyala.css"/>
<title>Limiting Concurrent Streams per Viewer</title>
</head>
<body id="concept_ynm_ms5_3j">


  
 
<h1 class="title topictitle1">Limiting Concurrent Streams per Viewer</h1>

  
  <div class="body conbody"><p class="shortdesc"> By default, your Ooyala Backlot provider account limits each viewer account to 2
    concurrent streams. This feature discourages viewers from sharing their credentials with friends
    who don’t have accounts. If the viewer, or someone with their account credentials, tries to open
    an additional stream while the maximum number of streams is open, the player displays a message
    and refuses to open the stream. This default limit applies across all of the syndication groups
    (aka publishing rules) within your provider account.  You change this limit, and you can enable
    or disable the limit on a per-group basis. You can also enable or disable this setting for the
    default group. You can change your Ooyala Backlot provider account limit. You can also set this
    type of limit <em class="ph i">at the asset level</em>. For example, your provider account limit could be 3,
    and your asset-level limit could be 1. In this case, three friends or family members could log
    in using the same credentials and watch three different assets concurrently, but would be
    blocked from watching any particular asset concurrently.</p>

    <div class="section"><h2 class="title sectiontitle">Change the limit for your provider account</h2><p class="p">To change the provider account limit, ask your contact person at Ooyala to set the new limit.
        Also enable this limit using the Backlot UI or a Backlot API call. This approach is intended
        to prevent the limit from being changed accidentally.</p>

          <p class="p"><strong class="ph b">In the Backlot UI</strong></p>
<ol class="ol">
        <li class="li">Log in to <span class="ph">Backlot UI</span>.</li>

        <li class="li">Click the <span class="ph uicontrol">PUBLISH</span> tab.</li>

        <li class="li">Click the <span class="ph uicontrol">Syndication Controls</span>
          subtab.</li>

        <li class="li">On the left, select the appropriate <span class="ph uicontrol">Syndication Group</span> or
            <span class="ph uicontrol">Default Group</span>.</li>

        <li class="li">On the right, verify that the checkbox for <strong class="ph b">Require Ooyala Player Token</strong> is
          checked.
          (Available only if your Ooyala account includes this functionality. To enable Ooyala Player Token, contact your account manager.)
        </li>

        <li class="li">Under <strong class="ph b">Require Ooyala Player Token</strong>, check <strong class="ph b">Limit per-user concurrent
          streams</strong>. You have now enabled the restriction of concurrent streams for your account,
          but you have not set the limit. </li>

        <li class="li">Contact your Ooyala contact person to set the provider level limit.</li>

      </ol>
<p class="p"><strong class="ph b">With the Backlot API</strong></p>
<ol class="ol">
        <li class="li">Add the <samp class="ph codeph">restrict_concurrent_streams</samp> property to the
          publishing rules and set its value to <span class="keyword parmname">true</span>. For example, add this
          property to a previously created publishing rule by making a call to
          https://api.ooyala.com:
          <pre class="pre codeblock">[PATCH]/v2/publishing_rules/9b70a34a67881c7a291d8b{
   “restrict_concurrent_streams” : “true”
}</pre>

        </li>

        <li class="li">Ask your Ooyala contact to set the provider level limit.</li>

      </ol>
</div>

    <div class="section"><h2 class="title sectiontitle">Enabling An Asset Limit</h2>You can enable a concurrent stream limit at the
      asset level and set it yourself with a Backlot API call. <p class="p"><strong class="ph b">With the Backlot API</strong></p>
<ol class="ol">
        <li class="li">Set the asset limit by adding the property max_concurrent_streams to the appropriate
          publishing rules. Include an integer that represents the asset limit. In the following
          example, this property is added to a previously created publishing rule by making a call
          to https://api.ooyala.com:
          <pre class="pre codeblock">[PATCH]/v2/publishing_rules/9b70a34a67881c7a291d8b{
   “restrict_concurrent_streams” : “true”, “max_concurrent_streams” : “1”
}</pre>

        </li>
</ol>
</div>

    <div class="section"><h2 class="title sectiontitle">Using Publishing Rules and Entitlements to Apply an Asset Limit</h2>
      
      <p class="p">You can apply limits to an asset using three different approaches:</p>

      <div class="p">
        <ul class="ul" id="concept_ynm_ms5_3j__ul_ybt_wtm_px">
          <li class="li">You can use Rights Locker to create an entitlement that contains an asset limit, and
            then use Backlot to apply that entitlement to an asset (using <strong class="ph b">Require user
              entitlement</strong>).</li>

          <li class="li">You can use Backlot create a syndication group (aka publishing rule) that contains an
            asset limit, and associate an group with an asset (using the
              <span class="ph uicontrol">Publish</span> or <span class="ph uicontrol">Manage</span> tab).</li>

          <li class="li">You can do both: Apply an entitlement to an asset and associate that asset with a
            group. In this case, the entitlement's limit overrides the groups' limit.</li>

        </ul>

      </div>

      <div class="note note"><span class="notetitle">Note:</span> To take down an unauthorized stream, delete an asset's entitlement, as described in
          <a class="xref" href="player_v3_stop_stream.html#stop_stream" title="Your Ooyala Backlot provider account can be configured to allow you to stop unauthorized streaming in realtime. Then, to stop unauthorized access to an asset as it is streaming, use Rights Locker to delete the entitlement or contact your Ooyala Customer Support Manager to do it for you. The deletion of the entitlement causes stream takedown to occur immediately.">Stopping Unauthorized Streams</a>
      </div>

      
<div class="tablenoborder"><table cellpadding="4" cellspacing="0" summary="" id="concept_ynm_ms5_3j__table_qpb_vhy_t5" class="table" frame="border" border="1" rules="all">
          
          
          
          <thead class="thead" align="left">
            <tr class="row">
              <th class="entry" valign="top" width="32.33695652173913%" id="d606128e166">Provider Level Limit</th>

              <th class="entry" valign="top" width="27.173913043478265%" id="d606128e169">Asset Limit</th>

              <th class="entry" valign="top" width="40.48913043478261%" id="d606128e172">Resulting Limits</th>

            </tr>

          </thead>

          <tbody class="tbody">
            <tr class="row">
              <td class="entry" valign="top" width="32.33695652173913%" headers="d606128e166 ">-</td>

              <td class="entry" valign="top" width="27.173913043478265%" headers="d606128e169 ">-</td>

              <td class="entry" valign="top" width="40.48913043478261%" headers="d606128e172 ">No more than 2 (default) per user account per provider.</td>

            </tr>

            <tr class="row">
              <td class="entry" valign="top" width="32.33695652173913%" headers="d606128e166 ">3</td>

              <td class="entry" valign="top" width="27.173913043478265%" headers="d606128e169 ">-</td>

              <td class="entry" valign="top" width="40.48913043478261%" headers="d606128e172 ">No more than 3 per user account per provider.</td>

            </tr>

            <tr class="row">
              <td class="entry" valign="top" width="32.33695652173913%" headers="d606128e166 ">3</td>

              <td class="entry" valign="top" width="27.173913043478265%" headers="d606128e169 ">1</td>

              <td class="entry" valign="top" width="40.48913043478261%" headers="d606128e172 ">1 per asset. No more than 3 per user account per provider.</td>

            </tr>

            <tr class="row">
              <td class="entry" valign="top" width="32.33695652173913%" headers="d606128e166 ">1</td>

              <td class="entry" valign="top" width="27.173913043478265%" headers="d606128e169 ">3</td>

              <td class="entry" valign="top" width="40.48913043478261%" headers="d606128e172 ">1 per asset and 1 per user account per provider.</td>

            </tr>

          </tbody>

        </table>
</div>

    </div>

    <div class="section" id="concept_ynm_ms5_3j__use_case"><h2 class="title sectiontitle">Asset Limit Use Case</h2>
      
      <div class="p">The scenario requiring an asset limit: <ul class="ul">
          <li class="li">A publisher named "Movie Provider" wants to sell the movie <em class="ph i">Ooyala Movie</em> as an
            Electronic Sell Through (EST) asset. </li>

          <li class="li"><em class="ph i">Ooyala Movie</em> must have an asset limit of 3.</li>

          <li class="li">User "Fan" purchases <em class="ph i">Ooyala Movie</em> from Movie Provider.</li>

        </ul>
</div>

      <p class="p">To restrict Fan from watching <em class="ph i">Ooyala Movie</em> on more than 3 concurrent streams, Movie
        Provider could perform one of the following actions: </p>

     <ul class="ul">
       <li class="li">Create a publishing rule in Backlot ("EST" publishing rule, for example) with
          restrict_concurrent_stream set to true and max_concurrent_stream set to 3.</li>

       <li class="li">Associate <em class="ph i">Ooyala Movie</em> with a "default" publishing rule in the Backlot UI by
          enabling <strong class="ph b">Require user entitlement</strong>.</li>

       <li class="li">Using Ooyala Rights Locker API, create an entitlement for the user, Fan, that allows him
          to watch <em class="ph i">Ooyala Movie</em>, and associate the "EST publishing rule" with this
          entitlement. See
         <a class="xref" href="book_rl_api.html" title="Rights Locker is a set of application programming interfaces (APIs) for defining and managing entitlements to digital assets.">Rights Locker API Reference</a>.</li>


     </ul>

     
    </div>

    <div class="section"><h2 class="title sectiontitle">Limiting Concurrent Streams at Account Level</h2>
      
      <p class="p">Besides having concurrent streams limit at different levels (global, provider, asset), you can set a new limit at account level. This level has the highest priority; that is to say, if the provider limit is set to 3 and the account limit set to 1, limit 1 is taken as the maximum concurrent streams limit.</p>

      <p class="p">This attribute is saved in Rights Locker Database.</p>

      <p class="p"><strong class="ph b">Set the Limit for your Account</strong></p>

      <p class="p">Use the following endpoint to set the limit at account level:</p>

      <pre class="pre codeblock">[POST] /concurrent_streams/pcode/{pcode}/account_id/{account_id}/limit/{limit}</pre>

      <p class="p">The response is a simple success <samp class="ph codeph">json</samp>:
      </p>

      <pre class="pre codeblock">{   "message": "OK"   }</pre>

      <div class="p">
        
<div class="tablenoborder"><table cellpadding="4" cellspacing="0" summary="" id="concept_ynm_ms5_3j__table_bgp_s2k_r2b" class="table" frame="border" border="1" rules="all"><caption><span class="tablecap">Table 1. Examples:</span></caption>
            
            
            
            <thead class="thead" align="left">
              <tr class="row">
                <th class="entry" align="center" valign="top" width="33.33333333333333%" id="d606128e343">Param Limit</th>

                <th class="entry" align="center" valign="top" width="33.33333333333333%" id="d606128e346">Account Limit</th>

                <th class="entry" align="center" valign="top" width="33.33333333333333%" id="d606128e349">Limit Taken</th>

              </tr>

            </thead>

            <tbody class="tbody">
              <tr class="row">
                <td class="entry" align="center" valign="top" width="33.33333333333333%" headers="d606128e343 ">2</td>

                <td class="entry" align="center" valign="top" width="33.33333333333333%" headers="d606128e346 ">1</td>

                <td class="entry" align="center" valign="top" width="33.33333333333333%" headers="d606128e349 ">1</td>

              </tr>

              <tr class="row">
                <td class="entry" align="center" valign="top" width="33.33333333333333%" headers="d606128e343 ">3</td>

                <td class="entry" align="center" valign="top" width="33.33333333333333%" headers="d606128e346 ">4</td>

                <td class="entry" align="center" valign="top" width="33.33333333333333%" headers="d606128e349 ">4</td>

              </tr>

              <tr class="row">
                <td class="entry" align="center" valign="top" width="33.33333333333333%" headers="d606128e343 ">2</td>

                <td class="entry" align="center" valign="top" width="33.33333333333333%" headers="d606128e346 ">-</td>

                <td class="entry" align="center" valign="top" width="33.33333333333333%" headers="d606128e349 ">2</td>

              </tr>

            </tbody>

          </table>
</div>

      </div>

      <p class="p"><strong class="ph b">Delete the limit for your account</strong></p>

      <p class="p">Use the following endpoint to delete the limit at account level:</p>

      <pre class="pre codeblock">[DELETE] /concurrent_streams/pcode/{pcode}/account_id/{account_id}/limit</pre>

      <p class="p">The response is a simple success <samp class="ph codeph">json</samp>:
      </p>

      <pre class="pre codeblock"> {   "message": "OK"   } </pre>

      <p class="p"><strong class="ph b">Get all Account Attributes</strong></p>

      <p class="p">Use the following endpoint to get all account attributes, giving pcode and account ID:</p>

      <pre class="pre codeblock">[GET] /pcode/{pcode}/account_id/{account_id}/account_attributes</pre>

      <div class="p">The response is a <pre class="pre codeblock">json</pre>
 with all attributes that the account has:</div>

      <pre class="pre codeblock">[{"name":"max_concurrent_streams","value":"1"}]</pre>

    </div>

    <div class="section"><h2 class="title sectiontitle">How It Works</h2>
      
      <p class="p">Concurrent stream limits can be enforced on HTML5 players, Flash players, Google Android,
        and Apple iOS.</p>

      <p class="p">To enforce the concurrent stream limits, the player has to keep sending the heartbeat
        requests to Ooyala systems. Sending of heartbeat requests is already implemented on the
        Ooyala Flash player, HTML5 player, Chromecast, iOS and Android SDKs. On these platforms, you
        don't need to write any code for sending the heartbeat requests. Using any other player will
        require that you implement the heartbeat. You can configure the heartbeat by contacting your
        Ooyala contact person.</p>

      <p class="p">The Ooyala service keeps a count of the active streams for each of your viewers (customer
        accounts). When a viewer attempts to access your content, your client application program
        calls Ooyala’s Authorization API. The system returns: </p>

      <ul class="ul">
        <li class="li">An indication that a heartbeat is required: <samp class="ph codeph">require_heartbeat</samp></li>

        <li class="li">An authorization token: <samp class="ph codeph">auth_token</samp></li>

        <li class="li">A heartbeat interval in seconds: <samp class="ph codeph">heartbeat_interval</samp>
        </li>

      </ul>

      <p class="p">As long as the client maintains the heartbeat, the count of concurrent streams is
        maintained. After the viewer leaves the page or exits the mobile application, the client no
        longer sends the heartbeat, and the service lowers the count. </p>
<p class="p">Please note that the <samp class="ph codeph">account_id</samp> is needed to create a token for concurrent
        streams. </p>

      <div class="p">The table below shows the sequence of actions, from left to right and downward. 
<div class="tablenoborder"><table cellpadding="4" cellspacing="0" summary="" id="concept_ynm_ms5_3j__table_g3d_4w5_3j" class="table" frame="border" border="1" rules="all">
            
            
            
            <thead class="thead" align="left">
              <tr class="row">
                <th class="entry" valign="top" width="33.33333333333333%" id="d606128e496">Viewer</th>

                <th class="entry" valign="top" width="33.66336633663366%" id="d606128e499">The client application</th>

                <th class="entry" valign="top" width="33.003300330033%" id="d606128e502">Ooyala</th>

              </tr>

            </thead>

            <tbody class="tbody">
              <tr class="row">
                <td class="entry" valign="top" width="33.33333333333333%" headers="d606128e496 ">Access content</td>

                <td class="entry" valign="top" width="33.66336633663366%" headers="d606128e499 ">First GET to Authorization API</td>

                <td class="entry" valign="top" width="33.003300330033%" headers="d606128e502 ">Increment concurrent stream count by one.<div class="p">Return: <ul class="ul" id="concept_ynm_ms5_3j__ul_bgf_rw5_3j">
                      <li class="li"><samp class="ph codeph">require_heartbeat</samp> set to <samp class="ph codeph">true</samp></li>

                      <li class="li"><samp class="ph codeph">auth_token</samp></li>

                      <li class="li"><samp class="ph codeph">heartbeat_interval</samp> in seconds </li>

                    </ul>
</div>
</td>

              </tr>

              <tr class="row">
                <td class="entry" valign="top" width="33.33333333333333%" headers="d606128e496 "> </td>

                <td class="entry" valign="top" width="33.66336633663366%" headers="d606128e499 ">Immediately send <samp class="ph codeph">auth_token</samp> to Ooyala as heartbeat</td>

                <td class="entry" valign="top" width="33.003300330033%" headers="d606128e502 "> </td>

              </tr>

              <tr class="row">
                <td class="entry" valign="top" width="33.33333333333333%" headers="d606128e496 ">Begin and continue playback</td>

                <td class="entry" valign="top" width="33.66336633663366%" headers="d606128e499 ">Send <samp class="ph codeph">auth_token</samp> as heartbeat every
                    <samp class="ph codeph">heartbeat_interval</samp> seconds</td>

                <td class="entry" valign="top" width="33.003300330033%" headers="d606128e502 ">Respond “OK”<p class="p">Maintain concurrent stream count</p>
</td>

              </tr>

              <tr class="row">
                <td class="entry" valign="top" width="33.33333333333333%" headers="d606128e496 ">End playback</td>

                <td class="entry" valign="top" width="33.66336633663366%" headers="d606128e499 ">Stop sending heartbeat</td>

                <td class="entry" valign="top" width="33.003300330033%" headers="d606128e502 ">Decrement the counter by one</td>

              </tr>

            </tbody>

          </table>
</div>
</div>

      <p class="p">When the viewer closes the player in the web page or client application, the service stops
        receiving a heartbeat. After a period, the service stops the stream, invalidates the
          <samp class="ph codeph">auth_token</samp>, and decreases the count of concurrent streams by one. </p>

      <p class="p">For security reasons, Ooyala does not disclose the precise length of time before the
        service invalidates the <samp class="ph codeph">auth_token</samp>.</p>

    </div>

<div class="section"><h2 class="title sectiontitle">Syntax of Heartbeat HTTP Request and Response</h2>
      
<p class="p">The syntax of the GET request to maintain the heartbeat is as follows: </p>

  <pre class="pre codeblock">[GET]/sas/player_api/v1/auth_heartbeat/pcode/pcode/auth_token/auth_token</pre>


<p class="p">
  where <var class="keyword varname">pcode</var> is your provider code and <var class="keyword varname">auth_token</var> is the value of the <samp class="ph codeph">auth_token</samp> property returned by the Ooyala service.
</p>

  
<div class="note note"><span class="notetitle">Note:</span> To enforce content protection, when the client receives the first response that includes the
          <samp class="ph codeph">auth_token</samp>,  it immediately sends a heartbeat. It does not wait for
          <samp class="ph codeph">heartbeat_interval</samp> seconds before sending the first heartbeat. </div>
 

<p class="p">After that, the client GETs the heartbeat continually at <samp class="ph codeph">heartbeat_interval</samp>
        seconds until the viewer exits the player web page or application. </p>

  <div class="p">To use the asset limits feature, send <samp class="ph codeph">embed_code</samp> as a query parameter:
        <pre class="pre codeblock">[GET]/sas/player_api/v1/auth_heartbeat/pcode/pcode/auth_token/auth_token?
embed_code=embed_code</pre>

      </div>

  <p class="p">The response to a successful heartbeat request looks like this: </p>

  <pre class="pre codeblock">{
   "auth_token"=&gt;"ABC",
   "message"=&gt;"OK",
   "expires"=&gt;1360877041,
   "signature"=&gt;"2sBWFegOi+hqvz4ektiHM/VzO3cUoQ2c+5/YOgyldtw="
}</pre>

<p class="p"> Any message other than <samp class="ph codeph">“OK”</samp> indicates failure. In that case, the client
        application should stop playback. </p>

</div>

<div class="section"><h2 class="title sectiontitle">Full Example with All Properties</h2>
      <p class="p">The following example shows a first-time GET
        to the Authorization API. The response in this example highlights the following properties:
          <samp class="ph codeph">require_heartbeat</samp>, <samp class="ph codeph">auth_token</samp>, and
          <samp class="ph codeph">heartbeat_interval</samp>.  The service uses these properties to enforce the
        concurrent stream limit. Note that the actual values returned are much longer. The strings
        than is shown here have been shortened for ease of reading. Then follows the
        request/response sequence to maintain the heartbeat.</p>

      <strong class="ph b">First Request</strong>
      <pre class="pre codeblock">[GET]http://player.ooyala.com/sas/player_api/v1/authorization/embed_code/FoeGbkH9m/VxMDhwFbICE7ojQ9jZM? domain=gnarly.com&amp;embedToken=http%3A%2F%2Fplayer.ooyala.com%2Fsas%2Fembed_token%FoeGbkH9%3Faccount_id%3DTest_Account%26 api_key%3xxx%26expires%3Dyyy%26signature%3zzz</pre>

      Response <pre class="pre codeblock">{  
   "authorization_data"   =&gt;   {  
      "VxMDhwNzoq2j8qfyiG6FbICE7ojQ9jZM"      =&gt;      {  
         "authorized"         =&gt;true,
         "code"         =&gt;"0",
         "message"         =&gt;"authorized",
         "request_timestamp"         =&gt;"1360878715",
         "retry"         =&gt;nil,
         "synd_rule_failures"         =&gt;nil,
         "require_heartbeat"         =&gt;true,
         "streams"         =&gt;         [  
            {  
               "delivery_type"               =&gt;"hds",
               "url"               =&gt;               {  
                  "format"                  =&gt;"encoded",
                  "data"                  =&gt; 
 "aHR0cDovLmY0bQ=="
               }
            }
         ]
      }
   },
   "user_info"   =&gt;   {  
      "ip_address"      =&gt;"192.168.1.1",
      "domain"      =&gt;"gnarly.com",
      "request_timestamp"      =&gt;"1360878715",
      "account_id"      =&gt;"johnsmith",
      "country"      =&gt;"UNKNOWN",
      "timezone"      =&gt;-8.0,
      "continent"      =&gt;"NA"
   },
   "debug_data"   =&gt;   {  
      "server_latency"      =&gt;"58.778999999999996",
      "request_id"      =&gt;"4f397d7f6091ce8e7d43354c424095fe",
      "user_info"      =&gt;      {  
         "request_timestamp"         =&gt;"1360878715"
      }
   },
   "auth_token"   =&gt; 
 "WGd5uZ29WTFBpeDlnPT0K",
   "heartbeat_data"   =&gt;   {  
      "heartbeat_interval"      =&gt;300
   },
   "signature"   =&gt;"b09xu7UxL/uFRJ9MOkmhISpRSF21zcOK+7iv1LfcNVA="
}</pre>

      <strong class="ph b">Immediately Send Heartbeat</strong>
      <pre class="pre codeblock"> [GET]http://player.ooyala.com/sas/player_api/v1/auth_heartbeat/pcode/FoeGbkH9m/auth_token/WGd5uZ29WTFBpeDlnPT0K</pre>

      Response <pre class="pre codeblock">{
   "auth_token"=&gt;"ABC",
   "message"=&gt;"OK”,
   "expires"=&gt;1360877041,
   "signature"=&gt;"2sBWFegOi+hqvz4ektiHM/VzO3cUoQ2c+5/YOgyldtw="
}</pre>

      <strong class="ph b">Heartbeat Interval</strong>
      <p class="p">By default, this value is 300 seconds. This limit is configurable at the provider level,
        which will override the default value. The lower limit of the heartbeat interval is capped
        at 30 seconds. Please contact your account manager to configure this limit. </p>

      <pre class="pre codeblock">[GET]http://player.ooyala.com/sas/player_api/v1/auth_heartbeat/pcode/FoeGbkH9m/auth_token/WGd5uZ29WTFBpeDlnPT0K</pre>

      Response
      <pre class="pre codeblock">{
   "auth_token"=&gt;"ABC",
   "message"=&gt;"OK",
   "expires"=&gt;1360877046,
   "signature"=&gt;"2sBWFegOi+hqvz4ektiHM/VzO3cUoQ2c+5/YOgyldtw="
}</pre>

    </div>

    <div class="section"><h2 class="title sectiontitle">Configurable Padding (Heartbeat Latency)</h2>
      
      <p class="p">Configurable padding determines the lifetime of a stream. If this attribute is not set, a
        default latency of 30 seconds will be used. We recommend setting a default latency greater
        or equal to 10 seconds. Please contact your account manager to configure this limit. </p>

    </div>

    <div class="section"><h2 class="title sectiontitle">When the Limit is Reached </h2>
      <p class="p">When the limit is reached the viewer fails
        authorization. The response body, under the <samp class="ph codeph">authorized</samp> failure message,
        includes <samp class="ph codeph">code</samp> set to 18 and an explanatory message.
      </p>
<pre class="pre codeblock"> .
 .
 .
{  
   "authorized"   =&gt;false,
   "code"   =&gt;"18",
   "message"   =&gt;"Too many open videos. Close other videos on this account and try again in a few minutes.",
   "request_timestamp"   =&gt;"1361401545",
   "retry"   =&gt;nil,
   "synd_rule_failures"   =&gt;nil,
   "require_heartbeat"   =&gt;true
}
 .
 .
 .</pre>

      Ooyala’s HTML5 and Flash players catch this error message and display a pop-up message to the
      viewer.</div>

<div class="section"><h2 class="title sectiontitle">Exceptions You Must Catch on Mobile Applications</h2>
      
      <div class="p">On mobile client applications (Google Android and Apple iOS), when authorization fails or a
        heartbeat fails, the following exceptions are thrown. 
<div class="tablenoborder"><table cellpadding="4" cellspacing="0" summary="" id="concept_ynm_ms5_3j__table_lmg_yx5_3j" class="table" frame="border" border="1" rules="all">
            
            
            
            <thead class="thead" align="left">
              <tr class="row">
                <th class="entry" valign="top" width="33.33333333333333%" id="d606128e757">Google Android</th>

                <th class="entry" valign="top" width="44.44444444444444%" id="d606128e760">Apple iOS</th>

                <th class="entry" valign="top" width="22.22222222222222%" id="d606128e763">When Thrown</th>

              </tr>

            </thead>

            <tbody class="tbody">
              <tr class="row">
                <td class="entry" valign="top" width="33.33333333333333%" headers="d606128e757 ">ERROR_AUTHORIZATION_<p class="p">FAILED</p>
</td>

                <td class="entry" valign="top" width="44.44444444444444%" headers="d606128e760 ">OOOoyalaErrorCodeAuthorizationFailed</td>

                <td class="entry" valign="top" width="22.22222222222222%" headers="d606128e763 ">Concurrent stream limit reached</td>

              </tr>

              <tr class="row">
                <td class="entry" valign="top" width="33.33333333333333%" headers="d606128e757 ">ERROR_AUTHORIZATION_<p class="p">HEARTBEAT_FAILED</p>
</td>

                <td class="entry" valign="top" width="44.44444444444444%" headers="d606128e760 ">OOOoyalaErrorCodeHeartbeatFail</td>

                <td class="entry" valign="top" width="22.22222222222222%" headers="d606128e763 ">Failure in heartbeat request</td>

              </tr>

            </tbody>

          </table>
</div>
</div>

      <p class="p">When these exceptions are thrown, your client applications must catch them to display an
        appropriate message. For instance, on Android in Java, enclose your GETs for authorization
        and for a heartbeat in a try/catch structure. For iOS use whatever mechanism is standard for
        your company to accomplish “exception handling.” </p>

    </div>

    <div class="section"><h2 class="title sectiontitle">
    Other Behavioral Recommendations on Mobile and Desktop
      </h2>
      
<p class="p">In any application, if the viewer pauses a video, you should still send heartbeat requests. </p>

 <p class="p">On both desktops and mobile devices, a viewer can suspend an application into the background: </p>

 <ul class="ul">
   <li class="li">Your mobile application should save a timestamp before backgrounding and then cease sending
          heartbeats. When the viewer resumes the application, check the saved timestamp. If the
          elapsed time is less than <samp class="ph codeph">heartbeat_interval</samp>, simply resume playback.
          Otherwise, you should require reauthorization, get a fresh <samp class="ph codeph">auth_token</samp> and
          start a new heartbeat. </li>

   <li class="li">A suspended desktop application cannot continue sending heartbeats. This increases the
          likelihood that an <samp class="ph codeph">auth_token</samp> will expire before activity resumes. </li>

 </ul>

      <p class="p">To stop heartbeats completely:</p>

      <ul class="ul">
        <li class="li">On a desktop browser, the viewer has to exit the page.</li>

        <li class="li">On a mobile application, the viewer has to exit the application.</li>

  
      </ul>

      
    </div>

    <div class="section"><h2 class="title sectiontitle">About Channel Changing</h2>
  
<p class="p">For viewers who are channel changing, your program can pass previous <samp class="ph codeph">auth_token</samp>s
        for authorization so the count is not incremented against the limit. In this case, the
        viewer can quickly switch videos without raising the concurrent stream count. </p>

</div>

  </div>

<div class="related-links">
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a class="link" href="authorization_overview.html">Authorization</a></div>
</div>
</div>

</body>
</html>